window.simplePostMessage={};!function($){"$:nomunge";var interval_id,last_hash,cache_bust=1,rm_callback,FALSE=!1,postMessage="postMessage",addEventListener="addEventListener",p_receiveMessage,has_postMessage=window[postMessage];if(typeof window.opera!="undefined"&&window.opera.version&&parseInt(window.opera.version())==9){Event.prototype.__defineGetter__("origin",function(){return"http://"+this.domain})}$[postMessage]=function(message,target_url,target){if(!target_url){return}message=typeof message==="string"?encodeURIComponent(message):encodeURIComponent(JSON.stringify(message));target=target||parent;if(has_postMessage){target[postMessage](message,target_url.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else if(target_url){target.location=target_url.replace(/#.*$/,"")+"#"+ +new Date+cache_bust++ +"&"+message}};$.receiveMessage=p_receiveMessage=function(callback,source_origin,delay){if(has_postMessage){if(callback){rm_callback&&p_receiveMessage();rm_callback=function(e){if(typeof source_origin==="string"&&e.origin!==source_origin||typeof source_origin==="function"&&source_origin(e.origin)===FALSE){return FALSE}var f={};for(var i in e)f[i]=e[i];f.data=decodeURIComponent(f.data);try{f.data=JSON.parse(f.data)}catch(ex){}callback(f)}}if(window[addEventListener]){window[callback?addEventListener:"removeEventListener"]("message",rm_callback,FALSE)}else{window[callback?"attachEvent":"detachEvent"]("onmessage",rm_callback)}}else{interval_id&&clearInterval(interval_id);interval_id=null;if(callback){delay=typeof source_origin==="number"?source_origin:typeof delay==="number"?delay:100;interval_id=setInterval(function(){var hash=document.location.hash,re=/^#?\d+&/;if(hash!==last_hash&&re.test(hash)){last_hash=hash;callback({data:hash.replace(re,"")})}},delay)}}}}(window.simplePostMessage);
